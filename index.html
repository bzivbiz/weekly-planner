<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Weekly Task Planner - Plan and track your tasks">
  <meta name="theme-color" content="#2563eb">
  <title>Weekly Task Planner</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIldlZWtseSBUYXNrIFBsYW5uZXIiLAogICJzaG9ydF9uYW1lIjogIlRhc2sgUGxhbm5lciIsCiAgImRlc2NyaXB0aW9uIjogIlBsYW4gYW5kIHRyYWNrIHlvdXIgd2Vla2x5IHRhc2tzIHdpdGggdXJnZW5jeSBsZXZlbHMgYW5kIHRpbWUgdHJhY2tpbmciLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMyNTYzZWIiLAogICJvcmllbnRhdGlvbiI6ICJhbnkiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnJTNFJTNDcmVjdCB3aWR0aD0nMTAwJyBoZWlnaHQ9JzEwMCcgZmlsbD0nJTIzMjU2M2ViJy8lM0UlM0N0ZXh0IHg9JzUwJyB5PSc3MCcgZm9udC1zaXplPSc2MCcgdGV4dC1hbmNob3I9J21pZGRsZScgZmlsbD0nd2hpdGUnIGZvbnQtZmFtaWx5PSdBcmlhbCclM0UlRTIlOUMlOTMlM0MvdGV4dCUzRSUzQy9zdmclM0UiLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9CiAgXQp9">
  
  <!-- iOS PWA Support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Task Planner">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Lucide React Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #374151;
    }
    
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    
    /* Sticky first column styling */
    .sticky-col {
      position: sticky;
      left: 0;
      z-index: 2;
    }
    
    .sticky-col-header {
      position: sticky;
      left: 0;
      z-index: 20;
      background-color: #374151;
    }
    
    /* Sticky header row */
    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 10;
      background-color: #374151 !important;
    }
    
    /* Corner cell gets highest z-index */
    .sticky-corner {
      position: sticky;
      left: 0;
      top: 0;
      z-index: 30;
      background-color: #374151 !important;
    }
    
    thead th {
      background-color: #374151 !important;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const DEFAULT_CATEGORIES = [
      { name: 'Work', color: 'bg-blue-100 border-blue-300 text-blue-900' },
      { name: 'Health', color: 'bg-green-100 border-green-300 text-green-900' },
      { name: 'Personal', color: 'bg-purple-100 border-purple-300 text-purple-900' },
      { name: 'Family', color: 'bg-pink-100 border-pink-300 text-pink-900' },
      { name: 'Finance', color: 'bg-yellow-100 border-yellow-300 text-yellow-900' },
      { name: 'Learning', color: 'bg-indigo-100 border-indigo-300 text-indigo-900' },
      { name: 'Social', color: 'bg-orange-100 border-orange-300 text-orange-900' },
      { name: 'Maintenance', color: 'bg-gray-100 border-gray-300 text-gray-900' }
    ];

    const DAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const IMPORTANCE_LEVELS = ['A', 'B', 'C', 'D'];

    const SAMPLE_TASKS = [
      { id: 1, name: 'Email processing', category: 'Work', importance: 'A', minutes: 30 },
      { id: 2, name: 'Project planning', category: 'Work', importance: 'A', minutes: 60 },
      { id: 3, name: 'Exercise', category: 'Health', importance: 'A', minutes: 45 },
      { id: 4, name: 'Meditation', category: 'Health', importance: 'B', minutes: 20 },
      { id: 5, name: 'Reading', category: 'Learning', importance: 'B', minutes: 30 }
    ];

    function WeeklyPlanner() {
      const [tasks, setTasks] = useState([]);
      const [categories, setCategories] = useState(DEFAULT_CATEGORIES);
      const [weeklyData, setWeeklyData] = useState({});
      const [currentWeekStart, setCurrentWeekStart] = useState(getSunday(new Date()));
      const [loading, setLoading] = useState(true);
      const [showTaskManager, setShowTaskManager] = useState(false);
      const [sortConfig, setSortConfig] = useState({ key: null, direction: 'asc' });
      const [isMobile, setIsMobile] = useState(false);
      const [selectedDay, setSelectedDay] = useState(0); // For mobile day selector

      useEffect(() => {
        loadData();
        
        // Detect mobile device
        const checkMobile = () => {
          setIsMobile(window.innerWidth < 768);
        };
        checkMobile();
        window.addEventListener('resize', checkMobile);
        
        return () => {
          window.removeEventListener('resize', checkMobile);
        };
      }, []);

      async function loadData() {
        try {
          const tasksResult = await window.storage.get('planner-tasks', false);
          const weeklyResult = await window.storage.get('planner-weekly', false);
          const categoriesResult = await window.storage.get('planner-categories', false);
          
          if (tasksResult?.value) {
            setTasks(JSON.parse(tasksResult.value));
          } else {
            setTasks(SAMPLE_TASKS);
          }
          
          if (weeklyResult?.value) {
            setWeeklyData(JSON.parse(weeklyResult.value));
          }
          
          if (categoriesResult?.value) {
            setCategories(JSON.parse(categoriesResult.value));
          }
        } catch (error) {
          console.log('First time load, using sample data');
          setTasks(SAMPLE_TASKS);
        }
        setLoading(false);
      }

      async function saveData() {
        try {
          await window.storage.set('planner-tasks', JSON.stringify(tasks), false);
          await window.storage.set('planner-weekly', JSON.stringify(weeklyData), false);
          await window.storage.set('planner-categories', JSON.stringify(categories), false);
        } catch (error) {
          console.error('Save error:', error);
        }
      }

      useEffect(() => {
        if (!loading) {
          saveData();
        }
      }, [tasks, weeklyData, categories]);

      function getSunday(date) {
        const d = new Date(date);
        const day = d.getDay();
        const diff = d.getDate() - day;
        return new Date(d.setDate(diff));
      }

      function formatTime(minutes) {
        if (minutes === 0) return '0m';
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        if (hours === 0) return `${mins}m`;
        if (mins === 0) return `${hours}h`;
        return `${hours}h ${mins}m`;
      }

      function getWeekKey(date) {
        return date.toISOString().split('T')[0];
      }

      function setUrgency(taskId, dayIndex, urgency) {
        const weekKey = getWeekKey(currentWeekStart);
        const newWeeklyData = { ...weeklyData };
        
        if (!newWeeklyData[weekKey]) {
          newWeeklyData[weekKey] = {};
        }
        if (!newWeeklyData[weekKey][taskId]) {
          newWeeklyData[weekKey][taskId] = { urgencies: {}, completed: {} };
        }
        
        if (urgency === '') {
          delete newWeeklyData[weekKey][taskId].urgencies[dayIndex];
        } else {
          newWeeklyData[weekKey][taskId].urgencies[dayIndex] = parseInt(urgency);
        }
        
        setWeeklyData(newWeeklyData);
      }

      function toggleComplete(taskId, dayIndex) {
        const weekKey = getWeekKey(currentWeekStart);
        const newWeeklyData = { ...weeklyData };
        
        if (!newWeeklyData[weekKey]) {
          newWeeklyData[weekKey] = {};
        }
        if (!newWeeklyData[weekKey][taskId]) {
          newWeeklyData[weekKey][taskId] = { urgencies: {}, completed: {} };
        }
        
        newWeeklyData[weekKey][taskId].completed[dayIndex] = 
          !newWeeklyData[weekKey][taskId].completed[dayIndex];
        
        setWeeklyData(newWeeklyData);
      }

      function getTaskData(taskId) {
        const weekKey = getWeekKey(currentWeekStart);
        return weeklyData[weekKey]?.[taskId] || { urgencies: {}, completed: {} };
      }

      function calculateDayTotals(dayIndex) {
        const totals = { 
          total: 0, 
          completed: 0,
          byUrgency: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 } 
        };
        
        tasks.forEach(task => {
          const taskData = getTaskData(task.id);
          const urgency = taskData.urgencies[dayIndex];
          
          if (urgency !== undefined) {
            totals.total += task.minutes;
            totals.byUrgency[urgency] += task.minutes;
            
            if (taskData.completed[dayIndex]) {
              totals.completed += task.minutes;
            }
          }
        });
        
        return totals;
      }

      function sortTasks(key, dayIndex = null) {
        let direction = 'asc';
        if (sortConfig.key === key && sortConfig.dayIndex === dayIndex && sortConfig.direction === 'asc') {
          direction = 'desc';
        }
        
        setSortConfig({ key, direction, dayIndex });
      }

      function getSortedTasks() {
        if (!sortConfig.key) return tasks;
        
        const sorted = [...tasks].sort((a, b) => {
          let aValue, bValue;
          
          if (sortConfig.key === 'day') {
            const aData = getTaskData(a.id);
            const bData = getTaskData(b.id);
            aValue = aData.urgencies[sortConfig.dayIndex] || 999;
            bValue = bData.urgencies[sortConfig.dayIndex] || 999;
          } else if (sortConfig.key === 'name') {
            aValue = a.name.toLowerCase();
            bValue = b.name.toLowerCase();
          } else if (sortConfig.key === 'category') {
            aValue = a.category;
            bValue = b.category;
          } else if (sortConfig.key === 'importance') {
            aValue = a.importance;
            bValue = b.importance;
          } else if (sortConfig.key === 'minutes') {
            aValue = a.minutes;
            bValue = b.minutes;
          }
          
          if (aValue < bValue) return sortConfig.direction === 'asc' ? -1 : 1;
          if (aValue > bValue) return sortConfig.direction === 'asc' ? 1 : -1;
          return 0;
        });
        
        return sorted;
      }

      function calculateWeekTotals() {
        const totals = { total: 0, completed: 0, byUrgency: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 } };
        
        DAYS.forEach((_, dayIndex) => {
          const dayTotals = calculateDayTotals(dayIndex);
          totals.total += dayTotals.total;
          totals.completed += dayTotals.completed;
          Object.keys(dayTotals.byUrgency).forEach(urgency => {
            totals.byUrgency[urgency] += dayTotals.byUrgency[urgency];
          });
        });
        
        return totals;
      }

      function addTask(newTask) {
        const task = {
          ...newTask,
          id: Date.now()
        };
        setTasks([...tasks, task]);
      }

      function updateTask(updatedTask) {
        setTasks(tasks.map(t => t.id === updatedTask.id ? updatedTask : t));
      }

      function deleteTask(taskId) {
        setTasks(tasks.filter(t => t.id !== taskId));
      }

      function navigateWeek(direction) {
        const newDate = new Date(currentWeekStart);
        newDate.setDate(newDate.getDate() + (direction * 7));
        setCurrentWeekStart(getSunday(newDate));
      }

      function importPreviousWeek() {
        const prevWeekStart = new Date(currentWeekStart);
        prevWeekStart.setDate(prevWeekStart.getDate() - 7);
        const prevWeekKey = getWeekKey(prevWeekStart);
        const currentWeekKey = getWeekKey(currentWeekStart);
        
        if (!weeklyData[prevWeekKey]) {
          alert('No data found for previous week to import');
          return;
        }
        
        const newWeeklyData = { ...weeklyData };
        
        // Initialize current week if it doesn't exist
        if (!newWeeklyData[currentWeekKey]) {
          newWeeklyData[currentWeekKey] = {};
        }
        
        // Copy urgency assignments from previous week (but not completion status)
        Object.keys(weeklyData[prevWeekKey]).forEach(taskId => {
          const prevTaskData = weeklyData[prevWeekKey][taskId];
          newWeeklyData[currentWeekKey][taskId] = {
            urgencies: { ...prevTaskData.urgencies },
            completed: {} // Start with nothing completed
          };
        });
        
        setWeeklyData(newWeeklyData);
      }

      if (loading) {
        return <div className="flex items-center justify-center h-screen">Loading...</div>;
      }

      const weekTotals = calculateWeekTotals();
      const sortedTasks = getSortedTasks();
      
      const SortIcon = ({ columnKey, dayIndex = null }) => {
        const isActive = sortConfig.key === columnKey && 
                         (dayIndex === null || sortConfig.dayIndex === dayIndex);
        if (!isActive) return <span className="text-gray-400 ml-1">‚Üï</span>;
        return <span className="ml-1">{sortConfig.direction === 'asc' ? '‚Üë' : '‚Üì'}</span>;
      };

      // Mobile View
      if (isMobile) {
        const dayTotals = calculateDayTotals(selectedDay);
        const currentDate = new Date(currentWeekStart);
        currentDate.setDate(currentDate.getDate() + selectedDay);
        
        return (
          <div className="min-h-screen bg-gray-700 p-2">
            <div className="max-w-2xl mx-auto">
              <div className="bg-gray-800 rounded-lg shadow-lg p-4 mb-2 text-white">
                <h1 className="text-xl font-bold text-center mb-3">Weekly Planner</h1>
                
                {/* Week Navigation */}
                <div className="flex justify-between items-center mb-3">
                  <button
                    onClick={() => navigateWeek(-1)}
                    className="px-3 py-1 bg-gray-200 text-gray-900 rounded text-sm"
                  >
                    ‚Üê Prev
                  </button>
                  <button
                    onClick={importPreviousWeek}
                    className="px-2 py-1 bg-green-600 text-white text-xs rounded"
                  >
                    Import
                  </button>
                  <button
                    onClick={() => navigateWeek(1)}
                    className="px-3 py-1 bg-gray-200 text-gray-900 rounded text-sm"
                  >
                    Next ‚Üí
                  </button>
                </div>
                
                {/* Day Selector */}
                <div className="mb-3">
                  <select
                    value={selectedDay}
                    onChange={(e) => setSelectedDay(parseInt(e.target.value))}
                    className="w-full px-3 py-2 bg-gray-700 border border-gray-500 rounded text-white text-lg"
                  >
                    {DAYS.map((day, index) => {
                      const date = new Date(currentWeekStart);
                      date.setDate(date.getDate() + index);
                      return (
                        <option key={index} value={index}>
                          {day} - {date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                        </option>
                      );
                    })}
                  </select>
                </div>
                
                {/* Day Summary */}
                <div className="bg-gray-700 p-3 rounded-lg mb-3">
                  <div className="grid grid-cols-3 gap-2 text-center text-sm mb-2">
                    <div>
                      <div className="text-gray-300">Planned</div>
                      <div className="font-bold">{formatTime(dayTotals.total)}</div>
                    </div>
                    <div>
                      <div className="text-gray-300">Done</div>
                      <div className="font-bold text-green-400">{formatTime(dayTotals.completed)}</div>
                    </div>
                    <div>
                      <div className="text-gray-300">Left</div>
                      <div className="font-bold text-orange-400">{formatTime(dayTotals.total - dayTotals.completed)}</div>
                    </div>
                  </div>
                  <div className="w-full bg-gray-600 rounded-full h-3">
                    <div 
                      className="bg-green-500 h-3 rounded-full transition-all" 
                      style={{ width: `${dayTotals.total > 0 ? Math.round((dayTotals.completed / dayTotals.total) * 100) : 0}%` }}
                    ></div>
                  </div>
                </div>
                
                {/* Task Manager Button */}
                <button
                  onClick={() => setShowTaskManager(!showTaskManager)}
                  className="w-full mb-3 px-4 py-2 bg-blue-600 text-white rounded-lg"
                >
                  {showTaskManager ? 'Close' : 'Manage Tasks'}
                </button>
                
                {showTaskManager && (
                  <TaskManager
                    tasks={tasks}
                    categories={categories}
                    onAddTask={addTask}
                    onUpdateTask={updateTask}
                    onDeleteTask={deleteTask}
                    onUpdateCategories={setCategories}
                    onClose={() => setShowTaskManager(false)}
                  />
                )}
                
                {/* Task List for Selected Day */}
                {!showTaskManager && (
                  <div className="space-y-2">
                    {sortedTasks
                      .filter(task => getTaskData(task.id).urgencies[selectedDay] !== undefined)
                      .sort((a, b) => {
                        const aUrgency = getTaskData(a.id).urgencies[selectedDay] || 999;
                        const bUrgency = getTaskData(b.id).urgencies[selectedDay] || 999;
                        return aUrgency - bUrgency;
                      })
                      .map(task => {
                        const taskData = getTaskData(task.id);
                        const urgency = taskData.urgencies[selectedDay];
                        const isCompleted = taskData.completed[selectedDay];
                        const categoryColor = categories.find(c => c.name === task.category)?.color || '';
                        
                        return (
                          <div key={task.id} className={`${categoryColor} p-3 rounded-lg border-2`}>
                            <div className="flex items-start justify-between">
                              <div className="flex items-start gap-2 flex-1">
                                <input
                                  type="checkbox"
                                  checked={isCompleted || false}
                                  onChange={() => toggleComplete(task.id, selectedDay)}
                                  className="w-5 h-5 mt-1"
                                />
                                <div className="flex-1">
                                  <div className={`font-semibold ${isCompleted ? 'line-through opacity-60' : ''}`}>
                                    {task.name}
                                  </div>
                                  <div className="text-xs mt-1 opacity-80">
                                    {task.category} ‚Ä¢ {task.importance} ‚Ä¢ {task.minutes}m ‚Ä¢ U{urgency}
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    {sortedTasks.filter(task => getTaskData(task.id).urgencies[selectedDay] !== undefined).length === 0 && (
                      <div className="text-center text-gray-400 py-8">
                        No tasks assigned for this day
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      // Desktop View
      return (
        <div className="min-h-screen bg-gray-700 p-4">
          <div className="max-w-7xl mx-auto">
            <div className="bg-gray-800 rounded-lg shadow-lg p-6 mb-4 text-white">
              <div className="flex justify-between items-center mb-6">
                <h1 className="text-3xl font-bold text-gray-800">Weekly Task Planner</h1>
                <button
                  onClick={() => setShowTaskManager(!showTaskManager)}
                  className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                >
                  ‚öôÔ∏è Manage Tasks
                </button>
              </div>

              <div className="flex justify-between items-center mb-6">
                <button
                  onClick={() => navigateWeek(-1)}
                  className="px-4 py-2 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300"
                >
                  ‚Üê Previous Week
                </button>
                <div className="flex flex-col items-center gap-2">
                  <h2 className="text-xl font-semibold">
                    Week of {currentWeekStart.toLocaleDateString()}
                  </h2>
                  <button
                    onClick={importPreviousWeek}
                    className="px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700"
                  >
                    üì• Import Previous Week
                  </button>
                </div>
                <button
                  onClick={() => navigateWeek(1)}
                  className="px-4 py-2 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300"
                >
                  Next Week ‚Üí
                </button>
              </div>

              {showTaskManager && (
                <TaskManager
                  tasks={tasks}
                  categories={categories}
                  onAddTask={addTask}
                  onUpdateTask={updateTask}
                  onDeleteTask={deleteTask}
                  onUpdateCategories={setCategories}
                  onClose={() => setShowTaskManager(false)}
                />
              )}

              <div className="mb-6 bg-gradient-to-r from-gray-600 to-gray-700 p-4 rounded-lg border-2 border-gray-500">
                <h3 className="text-lg font-bold mb-3 text-center text-white">Daily Summary</h3>
                <div className="grid grid-cols-7 gap-2">
                  {DAYS.map((day, dayIndex) => {
                    const totals = calculateDayTotals(dayIndex);
                    const completionRate = totals.total > 0 ? Math.round((totals.completed / totals.total) * 100) : 0;
                    return (
                      <div key={day} className="bg-gray-700 p-3 rounded-lg shadow-sm border border-gray-500 text-white">
                        <h4 className="font-bold text-center mb-2 text-sm">{day}</h4>
                        <div className="space-y-1 text-xs">
                          <div className="flex justify-between">
                            <span className="text-gray-300">Planned:</span>
                            <span className="font-semibold">{formatTime(totals.total)}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-300">Done:</span>
                            <span className="font-semibold text-green-400">{formatTime(totals.completed)}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-300">Left:</span>
                            <span className="font-semibold text-orange-400">{formatTime(totals.total - totals.completed)}</span>
                          </div>
                          <div className="mt-2 pt-2 border-t border-gray-500">
                            <div className="w-full bg-gray-600 rounded-full h-2">
                              <div 
                                className="bg-green-500 h-2 rounded-full transition-all" 
                                style={{ width: `${completionRate}%` }}
                              ></div>
                            </div>
                            <p className="text-center mt-1 font-semibold">{completionRate}%</p>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>

              <div className="overflow-x-auto max-h-[600px] overflow-y-auto">
                <table className="w-full border-collapse">
                  <thead>
                    <tr>
                      <th 
                        className="border border-gray-600 p-2 bg-gray-700 sticky-corner cursor-pointer hover:bg-gray-600"
                        onClick={() => sortTasks('name')}
                      >
                        Task <SortIcon columnKey="name" />
                      </th>
                      <th 
                        className="border border-gray-600 p-2 bg-gray-700 sticky-header cursor-pointer hover:bg-gray-600"
                        onClick={() => sortTasks('category')}
                      >
                        Cat <SortIcon columnKey="category" />
                      </th>
                      <th 
                        className="border border-gray-600 p-2 bg-gray-700 sticky-header cursor-pointer hover:bg-gray-600"
                        onClick={() => sortTasks('importance')}
                      >
                        Imp <SortIcon columnKey="importance" />
                      </th>
                      <th 
                        className="border border-gray-600 p-2 bg-gray-700 sticky-header cursor-pointer hover:bg-gray-600"
                        onClick={() => sortTasks('minutes')}
                      >
                        Min <SortIcon columnKey="minutes" />
                      </th>
                      {DAYS.map((day, dayIndex) => (
                        <th 
                          key={day} 
                          className="border border-gray-600 p-2 bg-gray-700 sticky-header cursor-pointer hover:bg-gray-600"
                          onClick={() => sortTasks('day', dayIndex)}
                        >
                          {day} <SortIcon columnKey="day" dayIndex={dayIndex} />
                        </th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {sortedTasks.map(task => {
                      const taskData = getTaskData(task.id);
                      const categoryColor = categories.find(c => c.name === task.category)?.color || '';
                      
                      return (
                        <tr key={task.id} className={`${categoryColor} border-2 text-sm`}>
                          <td className="border border-gray-600 p-1 font-medium sticky-col bg-inherit">
                            {task.name}
                          </td>
                          <td className="border border-gray-600 p-1 text-center text-xs">{task.category}</td>
                          <td className="border border-gray-600 p-1 text-center font-bold">{task.importance}</td>
                          <td className="border border-gray-600 p-1 text-center">{task.minutes}</td>
                          {DAYS.map((_, dayIndex) => (
                            <td key={dayIndex} className="border border-gray-600 p-1">
                              <div className="flex items-center gap-1">
                                <input
                                  type="text"
                                  value={taskData.urgencies[dayIndex] || ''}
                                  onChange={(e) => setUrgency(task.id, dayIndex, e.target.value)}
                                  className="w-7 text-center border rounded text-sm"
                                  maxLength="1"
                                  placeholder="-"
                                />
                                <input
                                  type="checkbox"
                                  checked={taskData.completed[dayIndex] || false}
                                  onChange={() => toggleComplete(task.id, dayIndex)}
                                  className="w-4 h-4"
                                  disabled={!taskData.urgencies[dayIndex]}
                                />
                              </div>
                            </td>
                          ))}
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>

              <div className="mt-6 grid grid-cols-8 gap-4">
                {DAYS.map((day, dayIndex) => {
                  const totals = calculateDayTotals(dayIndex);
                  return (
                    <div key={day} className="bg-gray-700 p-3 rounded-lg text-white">
                      <h3 className="font-bold text-center mb-2">{day}</h3>
                      <p className="text-center text-lg font-bold">{formatTime(totals.total)}</p>
                      <p className="text-center text-sm text-green-400">‚úì {formatTime(totals.completed)}</p>
                      <div className="text-xs mt-2 space-y-1">
                        {[1, 2, 3, 4, 5].map(urgency => (
                          totals.byUrgency[urgency] > 0 && (
                            <p key={urgency}>U{urgency}: {formatTime(totals.byUrgency[urgency])}</p>
                          )
                        ))}
                      </div>
                    </div>
                  );
                })}
                <div className="bg-blue-700 p-3 rounded-lg text-white">
                  <h3 className="font-bold text-center mb-2">Week</h3>
                  <p className="text-center text-lg font-bold">{formatTime(weekTotals.total)}</p>
                  <p className="text-center text-sm text-green-400">‚úì {formatTime(weekTotals.completed)}</p>
                  <div className="text-xs mt-2 space-y-1">
                    {[1, 2, 3, 4, 5].map(urgency => (
                      weekTotals.byUrgency[urgency] > 0 && (
                        <p key={urgency}>U{urgency}: {formatTime(weekTotals.byUrgency[urgency])}</p>
                      )
                    ))}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function TaskManager({ tasks, categories, onAddTask, onUpdateTask, onDeleteTask, onUpdateCategories, onClose }) {
      const [newTask, setNewTask] = useState({
        name: '',
        category: categories[0]?.name || 'Work',
        importance: 'B',
        minutes: 30
      });
      const [showCategoryEditor, setShowCategoryEditor] = useState(false);
      const [editingCategories, setEditingCategories] = useState([...categories]);
      const [sortBy, setSortBy] = useState('name');
      const [sortDirection, setSortDirection] = useState('asc');
      const [editingTaskId, setEditingTaskId] = useState(null);
      const [editingTask, setEditingTask] = useState(null);

      function handleSubmit(e) {
        e.preventDefault();
        if (newTask.name.trim()) {
          onAddTask(newTask);
          setNewTask({ name: '', category: categories[0]?.name || 'Work', importance: 'B', minutes: 30 });
        }
      }
      
      function updateCategoryName(index, newName) {
        const updated = [...editingCategories];
        updated[index] = { ...updated[index], name: newName };
        setEditingCategories(updated);
      }
      
      function saveCategoryChanges() {
        onUpdateCategories(editingCategories);
        setShowCategoryEditor(false);
      }
      
      function cancelCategoryChanges() {
        setEditingCategories([...categories]);
        setShowCategoryEditor(false);
      }
      
      function handleSort(column) {
        if (sortBy === column) {
          setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
        } else {
          setSortBy(column);
          setSortDirection('asc');
        }
      }
      
      function getSortedTasks() {
        const sorted = [...tasks].sort((a, b) => {
          let aVal, bVal;
          
          if (sortBy === 'name') {
            aVal = a.name.toLowerCase();
            bVal = b.name.toLowerCase();
          } else if (sortBy === 'category') {
            aVal = a.category;
            bVal = b.category;
          } else if (sortBy === 'importance') {
            aVal = a.importance;
            bVal = b.importance;
          } else if (sortBy === 'minutes') {
            aVal = a.minutes;
            bVal = b.minutes;
          }
          
          if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
          if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
          return 0;
        });
        
        return sorted;
      }
      
      function startEditing(task) {
        setEditingTaskId(task.id);
        setEditingTask({ ...task });
      }
      
      function cancelEditing() {
        setEditingTaskId(null);
        setEditingTask(null);
      }
      
      function saveEdit() {
        if (editingTask && editingTask.name.trim()) {
          onUpdateTask(editingTask);
        }
        setEditingTaskId(null);
        setEditingTask(null);
      }
      
      const SortIndicator = ({ column }) => {
        if (sortBy !== column) return <span className="text-gray-400 ml-1">‚Üï</span>;
        return <span className="ml-1">{sortDirection === 'asc' ? '‚Üë' : '‚Üì'}</span>;
      };

      const sortedTasks = getSortedTasks();

      return (
        <div className="mb-6 p-4 bg-gray-700 rounded-lg border-2 border-blue-400 text-white">
          <div className="flex justify-between items-center mb-4">
            <h3 className="text-xl font-bold">Task Manager</h3>
            <div className="flex gap-2">
              <button 
                onClick={() => setShowCategoryEditor(!showCategoryEditor)}
                className="px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-sm"
              >
                ‚úèÔ∏è Edit Categories
              </button>
              <button onClick={onClose} className="text-gray-600 hover:text-gray-800 text-2xl">‚úï</button>
            </div>
          </div>

          {showCategoryEditor && (
            <div className="mb-4 p-3 bg-gray-800 rounded-lg border-2 border-indigo-400">
              <h4 className="font-bold mb-2 text-white">Edit Category Names</h4>
              <div className="grid grid-cols-2 gap-2 mb-3">
                {editingCategories.map((cat, index) => (
                  <div key={index} className={`flex items-center gap-2 p-2 rounded ${cat.color}`}>
                    <input
                      type="text"
                      value={cat.name}
                      onChange={(e) => updateCategoryName(index, e.target.value)}
                      className="flex-1 px-2 py-1 border rounded text-sm text-gray-900"
                    />
                  </div>
                ))}
              </div>
              <div className="flex gap-2 justify-end">
                <button 
                  onClick={cancelCategoryChanges}
                  className="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400"
                >
                  Cancel
                </button>
                <button 
                  onClick={saveCategoryChanges}
                  className="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700"
                >
                  Save Changes
                </button>
              </div>
            </div>
          )}

          <form onSubmit={handleSubmit} className="mb-4 grid grid-cols-5 gap-2">
            <input
              type="text"
              placeholder="Task name"
              value={newTask.name}
              onChange={(e) => setNewTask({ ...newTask, name: e.target.value })}
              className="col-span-2 px-3 py-2 border rounded text-gray-900"
            />
            <select
              value={newTask.category}
              onChange={(e) => setNewTask({ ...newTask, category: e.target.value })}
              className="px-3 py-2 border rounded text-gray-900"
            >
              {categories.map(cat => (
                <option key={cat.name} value={cat.name}>{cat.name}</option>
              ))}
            </select>
            <select
              value={newTask.importance}
              onChange={(e) => setNewTask({ ...newTask, importance: e.target.value })}
              className="px-3 py-2 border rounded text-gray-900"
            >
              {IMPORTANCE_LEVELS.map(imp => (
                <option key={imp} value={imp}>{imp}</option>
              ))}
            </select>
            <div className="flex gap-2">
              <input
                type="number"
                placeholder="Minutes"
                value={newTask.minutes}
                onChange={(e) => setNewTask({ ...newTask, minutes: parseInt(e.target.value) })}
                className="w-20 px-3 py-2 border rounded text-gray-900"
              />
              <button type="submit" className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                ‚ûï
              </button>
            </div>
          </form>

          <div className="max-h-96 overflow-y-auto">
            <table className="w-full text-sm">
              <thead className="sticky top-0 bg-gray-600 z-10">
                <tr>
                  <th 
                    className="p-2 text-left cursor-pointer hover:bg-gray-500"
                    onClick={() => handleSort('name')}
                  >
                    Task <SortIndicator column="name" />
                  </th>
                  <th 
                    className="p-2 cursor-pointer hover:bg-gray-500"
                    onClick={() => handleSort('category')}
                  >
                    Category <SortIndicator column="category" />
                  </th>
                  <th 
                    className="p-2 cursor-pointer hover:bg-gray-500"
                    onClick={() => handleSort('importance')}
                  >
                    Importance <SortIndicator column="importance" />
                  </th>
                  <th 
                    className="p-2 cursor-pointer hover:bg-gray-500"
                    onClick={() => handleSort('minutes')}
                  >
                    Minutes <SortIndicator column="minutes" />
                  </th>
                  <th className="p-2">Actions</th>
                </tr>
              </thead>
              <tbody>
                {sortedTasks.map(task => (
                  <tr key={task.id} className="border-b border-gray-600">
                    {editingTaskId === task.id ? (
                      <>
                        <td className="p-2">
                          <input
                            type="text"
                            value={editingTask.name}
                            onChange={(e) => setEditingTask({ ...editingTask, name: e.target.value })}
                            className="w-full px-2 py-1 border rounded text-gray-900 text-sm"
                          />
                        </td>
                        <td className="p-2">
                          <select
                            value={editingTask.category}
                            onChange={(e) => setEditingTask({ ...editingTask, category: e.target.value })}
                            className="w-full px-2 py-1 border rounded text-gray-900 text-sm"
                          >
                            {categories.map(cat => (
                              <option key={cat.name} value={cat.name}>{cat.name}</option>
                            ))}
                          </select>
                        </td>
                        <td className="p-2">
                          <select
                            value={editingTask.importance}
                            onChange={(e) => setEditingTask({ ...editingTask, importance: e.target.value })}
                            className="w-full px-2 py-1 border rounded text-gray-900 text-sm"
                          >
                            {IMPORTANCE_LEVELS.map(imp => (
                              <option key={imp} value={imp}>{imp}</option>
                            ))}
                          </select>
                        </td>
                        <td className="p-2">
                          <input
                            type="number"
                            value={editingTask.minutes}
                            onChange={(e) => setEditingTask({ ...editingTask, minutes: parseInt(e.target.value) })}
                            className="w-full px-2 py-1 border rounded text-gray-900 text-sm"
                          />
                        </td>
                        <td className="p-2">
                          <div className="flex gap-1">
                            <button
                              onClick={saveEdit}
                              className="text-green-400 hover:text-green-300 text-xs"
                            >
                              Save
                            </button>
                            <button
                              onClick={cancelEditing}
                              className="text-red-400 hover:text-red-300 text-xs"
                            >
                              Cancel
                            </button>
                          </div>
                        </td>
                      </>
                    ) : (
                      <>
                        <td className="p-2">{task.name}</td>
                        <td className="p-2 text-center">{task.category}</td>
                        <td className="p-2 text-center">{task.importance}</td>
                        <td className="p-2 text-center">{task.minutes}</td>
                        <td className="p-2 text-center">
                          <div className="flex gap-1 justify-center">
                            <button
                              onClick={() => startEditing(task)}
                              className="text-blue-400 hover:text-blue-300 text-xs"
                            >
                              Edit
                            </button>
                            <button
                              onClick={() => onDeleteTask(task.id)}
                              className="text-red-400 hover:text-red-300 text-xs"
                            >
                              Delete
                            </button>
                          </div>
                        </td>
                      </>
                    )}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    function App() {
      const [installPrompt, setInstallPrompt] = useState(null);
      const [isInstalled, setIsInstalled] = useState(false);
      
      useEffect(() => {
        if (window.matchMedia('(display-mode: standalone)').matches) {
          setIsInstalled(true);
        }
        
        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          setInstallPrompt(e);
        });
      }, []);
      
      const handleInstall = async () => {
        if (!installPrompt) return;
        
        installPrompt.prompt();
        const { outcome } = await installPrompt.userChoice;
        
        if (outcome === 'accepted') {
          setInstallPrompt(null);
          setIsInstalled(true);
        }
      };
      
      return (
        <div>
          {installPrompt && !isInstalled && (
            <div className="bg-blue-600 text-white p-3 text-center">
              <p className="inline mr-4">Install this app on your device for offline access!</p>
              <button 
                onClick={handleInstall}
                className="bg-white text-blue-600 px-4 py-2 rounded-lg font-semibold hover:bg-blue-50"
              >
                Install App
              </button>
            </div>
          )}
          <WeeklyPlanner />
        </div>
      );
    }
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
  
  <script>
    // Simplified storage API without events that trigger tracking prevention
    window.storage = {
      async get(key, shared) {
        try {
          const storageKey = `planner_${key}`;
          const value = localStorage.getItem(storageKey);
          return value ? { key, value, shared: false } : null;
        } catch (error) {
          console.error('Storage get error:', error);
          return null;
        }
      },
      async set(key, value, shared) {
        try {
          const storageKey = `planner_${key}`;
          localStorage.setItem(storageKey, value);
          return { key, value, shared: false };
        } catch (error) {
          console.error('Storage set error:', error);
          return null;
        }
      },
      async delete(key, shared) {
        try {
          const storageKey = `planner_${key}`;
          localStorage.removeItem(storageKey);
          return { key, deleted: true, shared: false };
        } catch (error) {
          console.error('Storage delete error:', error);
          return null;
        }
      },
      async list(prefix, shared) {
        try {
          const keys = [];
          const prefixStr = `planner_${prefix || ''}`;
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith(prefixStr)) {
              keys.push(key.replace('planner_', ''));
            }
          }
          return { keys, prefix, shared: false };
        } catch (error) {
          console.error('Storage list error:', error);
          return { keys: [], prefix, shared: false };
        }
      }
    };
    
    // Auto-migrate existing data on first load
    (function migrateData() {
      const migrationFlag = localStorage.getItem('planner_migrated');
      if (!migrationFlag) {
        console.log('Migrating existing data to new format...');
        
        const existingData = {
          tasks: "[{\"name\":\"WSJ\",\"category\":\"reading\",\"importance\":\"C\",\"minutes\":45,\"id\":1771275285174},{\"name\":\"Calesthenics\",\"category\":\"exercise\",\"importance\":\"C\",\"minutes\":30,\"id\":1771275540463},{\"name\":\"email\",\"category\":\"at desk\",\"importance\":\"C\",\"minutes\":30,\"id\":1771275568207},{\"name\":\"Investment reading\",\"category\":\"investments\",\"importance\":\"B\",\"minutes\":45,\"id\":1771275642092},{\"name\":\"Lay out week\",\"category\":\"planning\",\"importance\":\"A\",\"minutes\":30,\"id\":1771275690070},{\"name\":\"Laundry\",\"category\":\"home\",\"importance\":\"D\",\"minutes\":60,\"id\":1771275728369},{\"name\":\"Investing course\",\"category\":\"writing\",\"importance\":\"A\",\"minutes\":60,\"id\":1771275938018},{\"name\":\"Walk/ruck\",\"category\":\"exercise\",\"importance\":\"C\",\"minutes\":60,\"id\":1771276285784},{\"name\":\"Desk clean/tidy\",\"category\":\"at desk\",\"importance\":\"C\",\"minutes\":15,\"id\":1771276308110},{\"name\":\"book/Kindle\",\"category\":\"reading\",\"importance\":\"B\",\"minutes\":30,\"id\":1771276332182},{\"name\":\"Podcasts\",\"category\":\"reading\",\"importance\":\"B\",\"minutes\":30,\"id\":1771276352222},{\"name\":\"Economist\",\"category\":\"reading\",\"importance\":\"C\",\"minutes\":30,\"id\":1771276371134},{\"name\":\"Raindrop\",\"category\":\"reading\",\"importance\":\"C\",\"minutes\":30,\"id\":1771276381950},{\"name\":\"Audible\",\"category\":\"reading\",\"importance\":\"C\",\"minutes\":45,\"id\":1771276401238},{\"name\":\"Quicken/bank/financial\",\"category\":\"at desk\",\"importance\":\"B\",\"minutes\":15,\"id\":1771276429439},{\"name\":\"Priorities by epoch\",\"category\":\"planning\",\"importance\":\"A\",\"minutes\":45,\"id\":1771276451006},{\"name\":\"travel\",\"category\":\"other\",\"importance\":\"B\",\"minutes\":240,\"id\":1771276487253},{\"name\":\"Ski/hike\",\"category\":\"exercise\",\"importance\":\"C\",\"minutes\":360,\"id\":1771276503213},{\"name\":\"Allocation sheets\",\"category\":\"investments\",\"importance\":\"C\",\"minutes\":60,\"id\":1771276523022},{\"name\":\"Vibe coding\",\"category\":\"other\",\"importance\":\"B\",\"minutes\":60,\"id\":1771276536877},{\"name\":\"Bike/spin/run/stairs\",\"category\":\"exercise\",\"importance\":\"C\",\"minutes\":60,\"id\":1771276567095},{\"name\":\"Investment action\",\"category\":\"investments\",\"importance\":\"A\",\"minutes\":30,\"id\":1771276577590},{\"name\":\"Reading notes\",\"category\":\"writing\",\"importance\":\"B\",\"minutes\":45,\"id\":1771276602319},{\"name\":\"Lulu-Lincoln\",\"category\":\"other\",\"importance\":\"D\",\"minutes\":45,\"id\":1771276623094},{\"name\":\"Sell stuff (Craigslist)\",\"category\":\"home\",\"importance\":\"C\",\"minutes\":30,\"id\":1771276648270},{\"name\":\"Pump bike tires\",\"category\":\"home\",\"importance\":\"D\",\"minutes\":30,\"id\":1771276667356},{\"name\":\"Forester due 87k 7/11/26\",\"category\":\"other\",\"importance\":\"C\",\"minutes\":60,\"id\":1771276719014},{\"name\":\"Xtrek due 24.5k 8/9/26\",\"category\":\"other\",\"importance\":\"C\",\"minutes\":60,\"id\":1771276754247},{\"name\":\"Summer activity\",\"category\":\"planning\",\"importance\":\"C\",\"minutes\":45,\"id\":1771276783359},{\"name\":\"Backpack plan\",\"category\":\"planning\",\"importance\":\"C\",\"minutes\":30,\"id\":1771276805486},{\"name\":\"Laundry\",\"category\":\"home\",\"importance\":\"C\",\"minutes\":60,\"id\":1771277285638}]",
          weekly: "{\"2026-02-16\":{\"1\":{\"urgencies\":{\"0\":2},\"completed\":{}},\"2\":{\"urgencies\":{\"0\":1},\"completed\":{}},\"3\":{\"urgencies\":{\"0\":2},\"completed\":{\"0\":true}}},\"2026-02-15\":{\"1771275285174\":{\"urgencies\":{\"2\":1,\"3\":1,\"4\":1,\"5\":1,\"6\":1},\"completed\":{}},\"1771275540463\":{\"urgencies\":{\"0\":3,\"1\":2,\"3\":2,\"4\":2,\"5\":2},\"completed\":{}},\"1771275568207\":{\"urgencies\":{\"0\":4,\"1\":2,\"2\":2,\"3\":2,\"4\":2,\"5\":2,\"6\":4},\"completed\":{}},\"1771275938018\":{\"urgencies\":{\"1\":2,\"3\":2,\"5\":2},\"completed\":{}},\"1771276285784\":{\"urgencies\":{\"1\":2,\"3\":2,\"5\":2},\"completed\":{}},\"1771276308110\":{\"urgencies\":{\"0\":2,\"1\":3,\"2\":3,\"3\":3,\"4\":3,\"5\":3},\"completed\":{}},\"1771276332182\":{\"urgencies\":{\"0\":3,\"1\":3,\"2\":3,\"3\":3,\"4\":3,\"5\":3,\"6\":3},\"completed\":{}},\"1771276352222\":{\"urgencies\":{\"1\":3,\"3\":3,\"5\":3},\"completed\":{}},\"1771276371134\":{\"urgencies\":{\"0\":3,\"1\":3,\"3\":3,\"4\":3,\"5\":3},\"completed\":{\"0\":true}},\"1771276381950\":{\"urgencies\":{\"0\":3,\"1\":3,\"2\":3,\"3\":3,\"4\":3,\"5\":3,\"6\":3},\"completed\":{\"0\":true}},\"1771276401238\":{\"urgencies\":{\"0\":4,\"1\":4,\"2\":4,\"3\":4,\"4\":4,\"5\":4,\"6\":4},\"completed\":{\"0\":true}},\"1771276429439\":{\"urgencies\":{\"0\":4,\"2\":4,\"3\":4,\"4\":4},\"completed\":{\"0\":true}},\"1771276451006\":{\"urgencies\":{\"4\":1},\"completed\":{}},\"1771276487253\":{\"urgencies\":{\"6\":2},\"completed\":{}},\"1771276503213\":{\"urgencies\":{\"2\":1},\"completed\":{}},\"1771276523022\":{\"urgencies\":{\"0\":3,\"3\":2},\"completed\":{\"0\":true}},\"1771276536877\":{\"urgencies\":{\"1\":3,\"4\":3},\"completed\":{\"1\":true}},\"1771276567095\":{\"urgencies\":{\"0\":3,\"4\":3},\"completed\":{\"0\":true}},\"1771277285638\":{\"urgencies\":{\"5\":4},\"completed\":{}},\"1771275642092\":{\"urgencies\":{\"0\":3,\"1\":3,\"3\":3,\"5\":3},\"completed\":{\"0\":true}},\"1771275690070\":{\"urgencies\":{\"0\":1},\"completed\":{\"0\":true}}}}",
          categories: "[{\"name\":\"at desk\",\"color\":\"bg-blue-100 border-blue-300 text-blue-900\"},{\"name\":\"investments\",\"color\":\"bg-green-100 border-green-300 text-green-900\"},{\"name\":\"exercise\",\"color\":\"bg-purple-100 border-purple-300 text-purple-900\"},{\"name\":\"planning\",\"color\":\"bg-pink-100 border-pink-300 text-pink-900\"},{\"name\":\"writing\",\"color\":\"bg-yellow-100 border-yellow-300 text-yellow-900\"},{\"name\":\"home\",\"color\":\"bg-indigo-100 border-indigo-300 text-indigo-900\"},{\"name\":\"reading\",\"color\":\"bg-orange-100 border-orange-300 text-orange-900\"},{\"name\":\"other\",\"color\":\"bg-gray-100 border-gray-300 text-gray-900\"}]"
        };
        
        localStorage.setItem('planner_tasks', existingData.tasks);
        localStorage.setItem('planner_weekly', existingData.weekly);
        localStorage.setItem('planner_categories', existingData.categories);
        localStorage.setItem('planner_migrated', 'true');
        
        console.log('Migration complete! Your data has been imported.');
      }
    })();
  </script>
</body>
</html>
